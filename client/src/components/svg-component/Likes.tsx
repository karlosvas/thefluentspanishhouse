import { UserContext } from "@/App";
import { updateLikes } from "@/scripts/render-data";
import { useContext, useEffect, useState } from "react";
import toast from "react-hot-toast";
import { type Comment } from "types/types";

const Likes = ({ comment }: { comment: Comment }) => {
  const user = useContext(UserContext);
  const uid_user_firebase = user?.uid || null;

  const [isActiveLike, setIsActiveLike] = useState(false);
  const [likes, setLikes] = useState(comment.likes);

  const handleLike = async () => {
    if (!user) {
      toast.error("Do you need to be logged in to like a comment");
      return;
    }

    if (isActiveLike) {
      setLikes(likes - 1);
    } else {
      setLikes(likes + 1);
    }

    if (uid_user_firebase)
      await updateLikes(uid_user_firebase, comment._id, likes);

    setIsActiveLike(!isActiveLike);
  };

  useEffect(() => {
    const fetchUserLikeStatus = async () => {
      try {
        if (!user) {
          setIsActiveLike(false);
          return;
        }
        const thisUserIsLiked = comment.likedBy.includes(
          uid_user_firebase as string
        );
        setIsActiveLike(thisUserIsLiked);
      } catch (error) {
        console.error(error);
      }
    };

    fetchUserLikeStatus();
  }, [user, uid_user_firebase, comment.likedBy]);

  return (
    <>
      <div id="likes">
        <svg
          width="40"
          height="40"
          viewBox="0 0 1024 1024"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          onClick={handleLike}
          id="like"
        >
          <path
            d="M283.392 454.949a51.648 51.648 0 0 1-0.017-1.303v-16.8c0 0.434 0.005 0.87 0.017 1.303v16.8zM740.945 455.033v-16.8l0.001-0.662v16.8l-0.001 0.662z"
            fill="#E8444D"
          />
          <path
            d="M283.598 441.674v16.8c0-1.172-0.134-2.352-0.207-3.527v-16.8c0.076 1.178 0.207 2.356 0.207 3.527zM740.945 455.033c-0.232 1.284-0.457 2.588-0.457 3.884v-16.8c0-1.297 0.225-2.6 0.457-3.884 0 5.04 0.451 11.781 0 16.8z"
            fill="#E8444D"
          />
          <path
            d="M283.598 441.674v16.8c0 1.47-0.208 2.921-0.993 4.331v-16.8c0.785-1.408 0.993-2.861 0.993-4.331z"
            fill="#E8444D"
          />
          <path
            d="M283.31 438.148h0.082c0.172 2.655 0.625 5.325-0.786 7.857v-7.76c0.153-0.041 0.308-0.07 0.459-0.087 0.083-0.006 0.163-0.01 0.245-0.01zM740.438 458.417v-16.8c0 1.486 0.193 2.956 0.957 4.389v16.8c-0.763-1.431-0.957-2.903-0.957-4.389zM384.008 382.215c-43.109 8.97-75.124 44.724-75.173 83.042v-16.8c0.049-38.318 32.064-74.071 75.173-83.042 6.605-1.375 13.065-2.257 19.373-2.65a4525.134 4525.134 0 0 1 0 0c2.524-0.157 5.024-0.233 7.499-0.233 26.435 0 50.118 8.912 70.935 26.429 6.321 5.314 12.467 10.78 18.706 16.174 4.181 3.611 7.826 5.403 11.495 5.403 3.731 0 7.486-1.851 11.85-5.526 3.605-3.038 7.109-6.168 10.641-9.275V412.542c-3.53 3.106-7.033 6.237-10.641 9.275-4.363 3.675-8.12 5.526-11.85 5.526-3.669 0-7.314-1.792-11.495-5.403-6.239-5.394-12.387-10.859-18.706-16.174-20.817-17.518-44.5-26.429-70.935-26.429-1.69 0-3.394 0.036-5.105 0.109-7.064 0.297-14.322 1.219-21.767 2.769zM534.507 412.537v-0.435-0.228-0.469-0.485-0.487-0.481-0.47-0.449-0.964-1.578-1.656-1.701-1.72-1.701-1.654-1.576-0.75c6.62-5.826 13.329-11.57 20.963-16.482 17.121-11.023 37.969-16.455 58.813-16.455 24.063 0 48.122 7.24 66.441 21.482 22.593 17.558 33.801 39.501 34.403 64.292v16.8c-0.605-24.792-11.813-46.736-34.403-64.292-18.319-14.243-42.379-21.483-66.441-21.483-20.844 0-41.688 5.432-58.813 16.456-7.633 4.915-14.343 10.658-20.963 16.486zM283.595 457.391v16.799c0-1.49-0.213-2.964-0.99-4.4v-16.8c0.774 1.436 0.99 2.909 0.99 4.401z"
            fill="#E8444D"
          />
          <path
            d="M283.595 457.391v16.8c0 1.146-0.127 2.301-0.223 3.455v-16.8c0.096-1.154 0.223-2.309 0.223-3.455z"
            fill="#E8444D"
          />
          <path
            d="M410.883 362.532c26.432 0 50.115 8.912 70.934 26.426 6.319 5.315 12.466 10.781 18.706 16.176 4.179 3.609 7.826 5.403 11.495 5.403 3.731 0 7.487-1.851 11.853-5.526 10.359-8.737 19.896-18.228 31.597-25.761 17.122-11.022 37.969-16.455 58.813-16.455 24.064 0 48.122 7.24 66.442 21.484 22.592 17.558 33.8 39.501 34.403 64.294-0.283 25.787-10.471 46.667-30.411 63.891-56.671 48.947-113.424 97.814-170.071 146.778-1.101 0.956-1.93 1.451-2.775 1.451-0.815 0-1.645-0.46-2.745-1.417-56.519-49.068-113.129-98.059-169.72-147.074-19.804-17.153-30.007-37.888-30.552-62.128-0.864-38.926 31.441-75.565 75.16-84.662 9.245-1.923 18.207-2.88 26.871-2.88z"
            fill={isActiveLike ? "#F05070" : "transparent"}
          />
          <path
            d="M308.836 465.343v-16.8c0 0.51 0.005 1.021 0.016 1.533 0.547 24.24 10.749 44.975 30.553 62.128 56.589 49.017 113.199 98.007 169.72 147.075 1.102 0.957 1.931 1.416 2.746 1.416 0.844 0 1.674-0.495 2.775-1.45 56.649-48.965 113.4-97.832 170.071-146.778 19.938-17.223 30.128-38.105 30.41-63.892v16.8c-0.282 25.787-10.47 46.669-30.41 63.892-56.671 48.946-113.425 97.813-170.071 146.778-1.101 0.956-1.931 1.45-2.775 1.45-0.815 0-1.645-0.459-2.746-1.416-56.518-49.068-113.129-98.059-169.72-147.075-19.804-17.153-30.007-37.887-30.553-62.127a78.782 78.782 0 0 1-0.016-1.534z"
            fill="#E8444D"
          />
          <path
            d="M740.945 438.233c-0.468 2.58-0.903 5.24 0.447 7.772v14.744c-2.217 4.93-2.155 10.256-3.629 15.34-5.887 20.285-17.519 37.703-34.563 52.418-60.127 51.949-120.307 103.858-180.48 155.761-3.669 3.165-7.228 4.744-10.79 4.744-3.599 0-7.204-1.609-10.922-4.827a478349.906 478349.906 0 0 1-179.86-155.763c-21.601-18.725-34.534-41.125-37.777-67.579 0.219-2.654 0.604-5.315-0.766-7.854v-6.983c1.411-2.534 0.957-5.201 0.786-7.857-0.36-14.725 5.31-28.159 13.193-40.87 13.003-20.995 32.076-36.813 56.731-47.394 17.466-7.494 35.979-11.296 55.182-11.296 2.715 0 5.447 0.077 8.191 0.228 29.523 1.632 55.651 10.825 77.878 28.022 4.689 3.623 9.162 7.403 13.636 11.192 1.818 1.533 2.789 2.285 3.764 2.285 0.975 0 1.956-0.755 3.801-2.233 10.491-8.424 20.563-17.248 33.162-23.492 17.791-8.815 36.664-14.082 57.214-15.232 3.114-0.175 6.2-0.262 9.245-0.262 30.692-0.003 58.014 8.848 81.929 26.145 22.883 16.551 37.033 37.912 42.81 63.308 0.722 3.157 0.839 6.429 0.818 9.683z m-56.229 74.231c19.938-17.222 30.129-38.103 30.411-63.891-0.605-24.791-11.813-46.736-34.403-64.292-18.319-14.242-42.379-21.483-66.441-21.483-20.844 0-41.688 5.432-58.813 16.456-11.7 7.533-21.237 17.023-31.599 25.76-4.365 3.675-8.122 5.526-11.852 5.526-3.669 0-7.314-1.792-11.496-5.403-6.238-5.394-12.387-10.859-18.706-16.174-20.817-17.519-44.5-26.429-70.934-26.429-8.664 0-17.627 0.958-26.873 2.884-43.719 9.097-76.022 45.735-75.156 84.662 0.544 24.24 10.745 44.975 30.55 62.126 56.589 49.018 113.199 98.009 169.72 147.075 1.102 0.957 1.929 1.417 2.744 1.417 0.846 0 1.679-0.495 2.776-1.451 56.651-48.968 113.4-97.836 170.072-146.783"
            fill={isActiveLike ? "#E84370" : "currentColor"}
          />
          <path
            d="M740.61 438.177c0.108 0.026 0.222 0.042 0.335 0.056 0.108 0.011 0.218 0.015 0.322 0.015l0.128-0.001v7.76c-1.351-2.532-0.916-5.194-0.785-7.83zM282.605 452.99c1.37 2.539 0.99 5.202 0.766 7.854l-0.393 0.029-0.373-0.122v-7.761z"
            fill={isActiveLike ? "#E8444D" : "currentColor"}
          />
          <path
            d="M283.371 460.846v16.8l-0.392 0.026v-16.8zM282.979 460.872v16.8l-0.374-0.122v-16.8z"
            fill={isActiveLike ? "#E8444D" : "currentColor"}
          />
          <path
            d="M741.396 460.75v16.8c-2.214 4.93-2.153 10.257-3.629 15.34-5.887 20.285-17.52 37.703-34.563 52.417-60.128 51.949-120.307 103.858-180.481 155.762-3.668 3.165-7.227 4.744-10.79 4.744-3.598 0-7.204-1.609-10.922-4.828a469353.24 469353.24 0 0 1-179.86-155.762c-21.6-18.726-34.534-41.125-37.777-67.579v-16.8c3.245 26.454 16.178 48.854 37.777 67.578a512359.912 512359.912 0 0 0 179.86 155.763c3.722 3.219 7.323 4.827 10.922 4.827 3.562 0 7.121-1.579 10.79-4.744 60.175-51.902 120.354-103.809 180.481-155.761 17.046-14.718 28.676-32.133 34.563-52.419 1.47-5.08 1.414-10.406 3.629-15.338z"
            fill={isActiveLike ? "#E84454" : "currentColor"}
          />
        </svg>
        {likes}
      </div>
    </>
  );
};

export default Likes;
